name: Check and Create ECR Repository

on:
  workflow_dispatch:

env:
  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  REGION: ${{ secrets.REGION }}

jobs:
  check_and_create_ecr:
    name: Check and Create ECR Repository
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ env.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ env.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.REGION }}

      - id: string
        uses: ASzc/change-string-case-action@v6
        with:
          string: ${{ github.event.repository.name }}

      - name: Check and create ECR repository
        id: ecr-repo
        uses: ./.github/actions/check-ecr-repository
        with:
          repository_name: ${{ steps.string.outputs.lowercase }}
          region: ${{ env.REGION }}
          repository_type: 'private'

      - name: ECR Repository status
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“¦ Repository Name: ${{ steps.ecr-repo.outputs.repository_name }}"
          echo "ğŸ“ Region: ${{ env.REGION }}"
          echo "âœ… Already Existed: ${{ steps.ecr-repo.outputs.exists }}"
          echo "ğŸ†• Created Now: ${{ steps.ecr-repo.outputs.created }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          if [ "${{ steps.ecr-repo.outputs.created }}" == "true" ]; then
            echo "âœ… Repository created successfully!"
          else
            echo "âœ… Repository already exists. Nothing to do."
          fi

